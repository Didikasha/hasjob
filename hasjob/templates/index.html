{%- from "domain.html" import org_profile with context %}
{% from "baseframe/forms.html" import renderfield, widgetscripts %}
{%- if not request.is_xhr -%}
  {% extends "layout.html" %}
  {% block titletags -%}
    <title>{% block title %}{% if title %}{{ title }} &mdash; {% endif %}{% if g.board %}{{ g.board.title }}{% else %}{{ config['SITE_TITLE'] }}{% endif %}{% endblock %}</title>
    <meta name="DC.title" content="{{ self.title() }}" />
    <meta property="og:title" content="{{ self.title() }}" />
  {%- endblock %}

  {% block pageheaders %}
  {%- if jobtype %}<link rel="alternate" type="application/atom+xml"  title="{{ jobtype.title }} – {{ config['SITE_TITLE']|e }}" href="{{ url_for('feed_by_type', name=jobtype.name) }}" />{% endif -%}
  {%- if jobcategory %}<link rel="alternate" type="application/atom+xml"  title="{{ jobcategory.title }} – {{ config['SITE_TITLE']|e }}" href="{{ url_for('feed_by_category', name=jobcategory.name) }}" />{% endif -%}
  {%- if md5sum %}<link rel="alternate" type="application/atom+xml" title="Jobs at {{ employer_name }} – {{ config['SITE_TITLE'] }}" href="{{ url_for('feed_by_email', md5sum=md5sum) }}" />{% endif -%}
  {%- if domain %}<link rel="alternate" type="application/atom+xml" title="Jobs at {{ employer_name }} – {{ config['SITE_TITLE'] }}" href="{{ url_for('feed_by_domain', domain=domain.name) }}" />{% endif -%}
  {%- if location %}<link rel="alternate" type="application/atom+xml" title="Jobs in {{ location['use_title'] }} – {{ config['SITE_TITLE'] }}" href="{{ url_for('feed_by_location', location=location['name']) }}" />{% endif -%}
  {%- if pay_graph_data %}<link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" />{% endif -%}
  {% endblock %}
  {% block description -%}
    {%- if location and location.description -%}
      {{ location.description|firstline }}
    {%- elif domain -%}
      {%- if domain.has_profile -%}
        {{ domain.description|firstline }}
      {%- else -%}
        All jobs at {{ domain.title or domain.name }}
      {%- endif -%}
    {%- else -%}
      {{ super() }}
    {%- endif -%}
  {%- endblock %}
  {% block canonical_url %}
    {%- if g.board and g.board.not_root and domain %}
      <link rel="canonical" href="{{ domain.url_for(subdomain=none) }}" />
      <meta property="og:url" content="{{ domain.url_for(subdomain=none) }}" />
    {%- else %}
      <link rel="canonical" href="{{ request.base_url }}" />
      <meta property="og:url" content="{{ request.base_url }}" />
    {%- endif %}
  {% endblock %}
{% endif %}
{% block content %}
  {%- include '_stickie_list.html' %}
{%- endblock -%}

{%- block footerscripts -%}
{%- if not request.is_xhr -%}
<script type="text/javascript">
  //For setting the pay slider
  window.Hasjob.PayFilterParameters = {
    'currency': {{ request.args.get('currency') | tojson }},
    'pmin': {{ request.args.get('pmin') | tojson }},
    'pmax': {{ request.args.get('pmax') | tojson }}
  };

  $(function() {
    $('textarea').autosize();
    $("#newpost_details").hide().removeClass('jshidden');
    $("#newpost_headline").focus(function() {
      $("#newpost_details").slideDown();
    }).keypress(function(event) {
      if(event.which == '13') {
        $(this).closest("form").submit();
        return false;
      }
    }).blur(function() {
      $(this).val($(this).val().replace(/(\r\n|\n|\r)/gm," ").replace(/\s+/g," "));
    });
  });
</script>
{%- if pay_graph_data %}
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
  <script type="text/javascript">
    c3.generate({
      bindto: '#pay-graph',
      size: {
        height: 150
      },
      data: {
        x: 'x',
        type: 'spline',
        columns: [
          ['x', {% for row in pay_graph_data['data'] %}{{ row[0]|tojson }}{% if not loop.last %}, {% endif %}{% endfor %}],
          ['jobs', {% for row in pay_graph_data['data'] %}{{ row[1]|tojson }}{% if not loop.last %}, {% endif %}{% endfor %}]
        ],
        names: {
          jobs: "Jobs"
        }
      },
      point: {
        show: false
      },
      legend: {
        show: false
      },
      axis: {
        x: {
          // padding: {
          //   left: 60000,
          //   right: 100000
          // },
          type: 'indexed',
          tick: {
            fit: true,
            format: function (x) { return window.Hasjob.Currency.formatTo({{ pay_graph_data['currency']|tojson }}, x); },
            // values: {{ pay_graph_data['xaxis']|tojson }}
          }
        },
        y: {
          label: "Jobs",
          show: true,
        }
      }
    });
  </script>
{%- endif %}
{%- endif -%} {#- if not request.xhr -#}
{% endblock %}
